{% extends "base.html" %}

{% block content %}
<div class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-lg">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">Crear una nueva cuenta</h1>

        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="mb-4">
            {% for category, message in messages %}
            <div class="alert {{ 'bg-red-100 border-l-4 border-red-500 text-red-700 p-4' if category == 'danger' else 'bg-green-100 border-l-4 border-green-500 text-green-700 p-4' }}"
                role="alert">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        <form id="registro-form" method="POST" action="{{ url_for('registro') }}" class="space-y-6">
            <div>
                <label for="nombre" class="block text-sm font-medium text-gray-700">Nombre completo:</label>
                <input type="text" id="nombre" name="nombre" required
                    class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-300 ease-in-out">
            </div>
            <div>
                <label for="email" class="block text-sm font-medium text-gray-700">Correo electrónico:</label>
                <input type="email" id="email" name="email" required
                    class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-300 ease-in-out">
            </div>
            <div>
                <label for="password" class="block text-sm font-medium text-gray-700">Contraseña:</label>
                <input type="password" id="password" name="password" required
                    class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-300 ease-in-out">
                <div id="password-feedback" class="mt-2 text-sm space-y-1">
                    <p id="length" class="text-red-500 flex items-center"><span class="mr-2">&times;</span>8 caracteres
                        mínimo</p>
                    <p id="uppercase" class="text-red-500 flex items-center"><span class="mr-2">&times;</span>Una letra
                        mayúscula</p>
                    <p id="lowercase" class="text-red-500 flex items-center"><span class="mr-2">&times;</span>Una letra
                        minúscula</p>
                    <p id="number" class="text-red-500 flex items-center"><span class="mr-2">&times;</span>Un número</p>
                    <p id="symbol" class="text-red-500 flex items-center"><span class="mr-2">&times;</span>Un símbolo
                        (!@#$%)</p>
                </div>
            </div>
            <div>
                <label for="password2" class="block text-sm font-medium text-gray-700">Repetir Contraseña:</label>
                <input type="password" id="password2" name="password2" required
                    class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-300 ease-in-out">
                <p id="match-feedback" class="mt-2 text-sm text-red-500 flex items-center hidden"><span
                        class="mr-2">&times;</span>Las contraseñas no coinciden</p>
            </div>
            <div>
                <label for="telefono" class="block text-sm font-medium text-gray-700">Teléfono (opcional):</label>
                <input type="tel" id="telefono" name="telefono"
                    class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-300 ease-in-out">
            </div>
            <div>
                <label for="direccion_envio" class="block text-sm font-medium text-gray-700">Dirección de envío
                    (opcional):</label>
                <textarea id="direccion_envio" name="direccion_envio" rows="3"
                    class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-300 ease-in-out"></textarea>
            </div>
            <div>
                <label for="direccion_facturacion" class="block text-sm font-medium text-gray-700">Dirección de
                    facturación (opcional):</label>
                <textarea id="direccion_facturacion" name="direccion_facturacion" rows="3"
                    class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-300 ease-in-out"></textarea>
            </div>
            <button type="submit" id="submit-btn" disabled
                class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-lg font-medium text-white bg-blue-400 cursor-not-allowed transition duration-300 ease-in-out">
                Registrarse
            </button>
        </form>
    </div>
</div>

<script>
    const passwordInput = document.getElementById('password');
    const password2Input = document.getElementById('password2');
    const submitBtn = document.getElementById('submit-btn');
    const length = document.getElementById('length');
    const uppercase = document.getElementById('uppercase');
    const lowercase = document.getElementById('lowercase');
    const number = document.getElementById('number');
    const symbol = document.getElementById('symbol');
    const matchFeedback = document.getElementById('match-feedback');

    function validatePassword() {
        const password = passwordInput.value;
        const password2 = password2Input.value;

        const hasLength = password.length >= 8;
        const hasUppercase = /[A-Z]/.test(password);
        const hasLowercase = /[a-z]/.test(password);
        const hasNumber = /[0-9]/.test(password);
        const hasSymbol = /[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]/.test(password);

        updateFeedback(length, hasLength);
        updateFeedback(uppercase, hasUppercase);
        updateFeedback(lowercase, hasLowercase);
        updateFeedback(number, hasNumber);
        updateFeedback(symbol, hasSymbol);

        const passwordsMatch = password === password2 && password.length > 0;
        if (password.length > 0 && password2.length > 0 && !passwordsMatch) {
            matchFeedback.classList.remove('hidden');
        } else {
            matchFeedback.classList.add('hidden');
        }

        const isPasswordValid = hasLength && hasUppercase && hasLowercase && hasNumber && hasSymbol;
        submitBtn.disabled = !(isPasswordValid && passwordsMatch);
        if (submitBtn.disabled) {
            submitBtn.classList.add('bg-blue-400', 'cursor-not-allowed');
            submitBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
        } else {
            submitBtn.classList.remove('bg-blue-400', 'cursor-not-allowed');
            submitBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
        }
    }

    function updateFeedback(element, isValid) {
        if (isValid) {
            element.classList.remove('text-red-500');
            element.classList.add('text-green-500');
            element.innerHTML = '<span class="mr-2">&#10003;</span>' + element.innerHTML.substring(element.innerHTML.indexOf('>') + 1);
        } else {
            element.classList.remove('text-green-500');
            element.classList.add('text-red-500');
            element.innerHTML = '<span class="mr-2">&times;</span>' + element.innerHTML.substring(element.innerHTML.indexOf('>') + 1);
        }
    }

    passwordInput.addEventListener('input', validatePassword);
    password2Input.addEventListener('input', validatePassword);
</script>

{% endblock %}